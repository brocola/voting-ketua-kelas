<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pemilihan Ketua Kelas</title>
<style>
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background: linear-gradient(180deg,#9fd8ff,#eaf6ff);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:10px;
}
.card{
  background:#fff;
  width:100%;
  max-width:360px;
  border-radius:20px;
  padding:25px;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  text-align:center;
  margin:10px 0;
}
input,button{
  width:100%;
  padding:14px;
  margin-top:12px;
  border-radius:12px;
  border:none;
  font-size:16px;
}
input{background:#f1f5f9;}
button{
  background:linear-gradient(135deg,#2563eb,#0ea5e9);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}
.candidate{
  border:2px solid #1e88e5;
  border-radius:15px;
  padding:15px;
  margin-top:15px;
  text-align:left;
}
.hide{display:none;}
</style>
</head>
<body>

<!-- SUDAH VOTING -->
<div class="card hide" id="done">
  <h2>âœ… Kamu sudah voting</h2>
  <p>Terima kasih</p>
</div>

<!-- MASUKKAN NAMA -->
<div class="card hide" id="login">
  <h2>Masukkan Nama</h2>
  <input id="nama" placeholder="Nama kamu">
  <button onclick="mulai()">Mulai</button>
</div>

<!-- VOTING -->
<div class="card hide" id="vote">
  <h2>Pilih Ketua Kelas</h2>

  <div class="candidate">
    <h3>Ananta</h3>
    <p>Visi: Kelas kompak dan aktif</p>
    <p>Misi: Disiplin & tanggung jawab</p>
    <button onclick="kirim('Ananta')">Pilih</button>
  </div>

  <div class="candidate">
    <h3>Ananta3</h3>
    <p>Visi: Kelas nyaman & rapi</p>
    <p>Misi: Kerja sama & saling menghargai</p>
    <button onclick="kirim('Ananta3')">Pilih</button>
  </div>
</div>

<!-- Tombol Reset Voting -->
<div class="card">
  <button onclick="resetVote()">Reset Voting</button>
</div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbxzvzcgGrrCIFQKL8m7vmgcNe0gtbZr0WiXx0MHO4FD1ZSAoiDNUAUYlBC9WX5gCGMJ/exec";

const done = document.getElementById("done");
const login = document.getElementById("login");
const vote = document.getElementById("vote");

// cek localStorage
if(localStorage.getItem("sudahVoting")){
  done.classList.remove("hide");
}else{
  login.classList.remove("hide");
}

// mulai voting setelah isi nama
function mulai(){
  const n = document.getElementById("nama").value.trim();
  if(!n){ alert("Isi nama dulu"); return; }
  localStorage.setItem("namaPemilih", n);
  login.classList.add("hide");
  vote.classList.remove("hide");
}

// kirim pilihan ke spreadsheet
function kirim(pilihan){
  if(localStorage.getItem("sudahVoting")){
    alert("Kamu sudah voting");
    return;
  }
  const nama = localStorage.getItem("namaPemilih");

  const data = new URLSearchParams();
  data.append("nama", nama);
  data.append("pilihan", pilihan);

  fetch(URL,{
    method:"POST",
    body:data
  }).then(res => res.text())
  .then(txt => {
    if(txt==="SUDAH"){
      alert("Nama ini sudah pernah voting");
      vote.classList.add("hide");
      login.classList.remove("hide");
    }else if(txt==="OK"){
      localStorage.setItem("sudahVoting","1");
      vote.classList.add("hide");
      done.classList.remove("hide");
    }else{
      alert("Gagal kirim data");
    }
  }).catch(()=>{
    alert("Gagal kirim data");
  });
}

// tombol reset vote
function resetVote(){
  localStorage.removeItem("sudahVoting");
  localStorage.removeItem("namaPemilih");
  alert("Sekarang kamu bisa vote lagi!");
  location.reload();
}
</script>

</body>
</html>