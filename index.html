<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pemilihan Ketua Kelas</title>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: 'Segoe UI', Arial, sans-serif;
    background: linear-gradient(180deg, #9fd8ff, #eaf6ff);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 15px;
  }
  /* KONTENER UTAMA - Ini yang bikin rapi */
  .main-card {
    background: #fff;
    width: 100%;
    max-width: 380px;
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    text-align: center;
  }
  h2 { color: #1e293b; margin-top: 0; }
  input, button {
    width: 100%;
    padding: 14px;
    margin-top: 12px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
  }
  input { background: #f1f5f9; border: 1px solid #cbd5e1; }
  button {
    background: linear-gradient(135deg, #2563eb, #0ea5e9);
    color: #fff;
    font-weight: bold;
    cursor: pointer;
  }
  .candidate {
    border: 2px solid #e2e8f0;
    border-radius: 15px;
    padding: 15px;
    margin-top: 15px;
    text-align: left;
  }
  .candidate h3 { margin: 0; color: #1e40af; }
  .candidate p { margin: 4px 0; font-size: 13px; color: #475569; }
  
  .hide { display: none; } /* Ini untuk menyembunyikan bagian yang belum perlu */

  .reset-btn {
    margin-top: 20px;
    background: none;
    color: #94a3b8;
    font-size: 12px;
    text-decoration: underline;
    padding: 5px;
  }
</style>
</head>
<body>

<div class="main-card">
  <div id="login-section">
    <h2>Masukkan Nama</h2>
    <p style="font-size: 14px; color: #64748b;">Silakan isi nama untuk mulai memilih.</p>
    <input id="nama-user" placeholder="Nama kamu...">
    <button onclick="mulaiVoting()">Mulai</button>
  </div>

  <div id="vote-section" class="hide">
    <h2>Pilih Ketua Kelas</h2>
    
    <div class="candidate">
      <h3>Ananta</h3>
      <p><b>Visi:</b> Kelas kompak dan aktif</p>
      <p><b>Misi:</b> Disiplin & tanggung jawab</p>
      <button onclick="kirimPilihan('Ananta')">Pilih Ananta</button>
    </div>

    <div class="candidate">
      <h3>Ananta 3</h3>
      <p><b>Visi:</b> Kelas nyaman & rapi</p>
      <p><b>Misi:</b> Kerja sama & menghargai</p>
      <button onclick="kirimPilihan('Ananta 3')">Pilih Ananta 3</button>
    </div>
  </div>

  <div id="done-section" class="hide">
    <div style="font-size: 50px;">âœ…</div>
    <h2>Terima Kasih!</h2>
    <p>Pilihan kamu sudah terkirim.</p>
  </div>

  <button class="reset-btn" onclick="resetSistem()">Reset Data Voting</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxzvzcgGrrCIFQKL8m7vmgcNe0gtbZr0WiXx0MHO4FD1ZSAoiDNUAUYlBC9WX5gCGMJ/exec";

const sectionLogin = document.getElementById("login-section");
const sectionVote = document.getElementById("vote-section");
const sectionDone = document.getElementById("done-section");

// Cek apakah sudah pernah vote
if(localStorage.getItem("voted")){
  sectionLogin.classList.add("hide");
  sectionDone.classList.remove("hide");
}

function mulaiVoting(){
  const nama = document.getElementById("nama-user").value.trim();
  if(!nama){ alert("Tolong isi nama dulu ya!"); return; }
  localStorage.setItem("user_name", nama);
  sectionLogin.classList.add("hide");
  sectionVote.classList.remove("hide");
}

function kirimPilihan(pilihan){
  const nama = localStorage.getItem("user_name");
  const btn = event.target;
  
  btn.innerText = "Mengirim...";
  btn.disabled = true;

  const formData = new URLSearchParams();
  formData.append("nama", nama);
  formData.append("pilihan", pilihan);

  fetch(SCRIPT_URL, {
    method: "POST",
    body: formData
  })
  .then(res => res.text())
  .then(res => {
    if(res === "OK"){
      localStorage.setItem("voted", "true");
      sectionVote.classList.add("hide");
      sectionDone.classList.remove("hide");
    } else {
      alert("Error: " + res);
      btn.innerText = "Pilih";
      btn.disabled = false;
    }
  })
  .catch(() => {
    alert("Gagal kirim. Cek koneksi internet.");
    btn.innerText = "Pilih";
    btn.disabled = false;
  });
}

function resetSistem(){
  if(confirm("Hapus status voting kamu?")){
    localStorage.clear();
    location.reload();
  }
}
</script>

</body>
</html>
